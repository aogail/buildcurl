#!/bin/bash

RECIPE="$1"
PREFIX=${PREFIX:="/usr/local"}
SOURCE=${SOURCE:="/opt/buildcurl"}
PATH=$SOURCE/helpers:$PATH

if [ -z "$LOGGER" ]; then LOGGER=$(mktemp) ; fi

rm -rf "$PREFIX" && mkdir -p "$PREFIX"
if [ -f  "$SOURCE/recipes/$RECIPE" ]; then
	if $SOURCE/recipes/$RECIPE "$PREFIX" &> $LOGGER ; then
		tar czf - -C "$PREFIX" .
	else
		if [ -f $LOGGER ] ; then
			echo "-----> BUILD FAILED, please see the details below:"
			cat $LOGGER
		fi
		exit 1
	fi
else
	echo "UNSUPPORTED RECIPE: $RECIPE"
	exit 2
fi
